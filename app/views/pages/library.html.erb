<body class="bg-dark-mode">
    <section>
        <h1 class="gothic-neo mb-8 pt-20 text-center text-gray-100">Library</h1>
        <div class="container mx-auto px-2">
            <div class="flex">
                <div class="w-1/3 sm:w-1/6">
                    <ul class="category-list list-reset">
                        <li><button id="showall" class="bg-dark-mode-lighter border border-gray-700 text-gray-100 hover:border-gray-700 hover:bg-gray-100 hover:text-gray-700 p-2 rounded w-full text-sm sm:text-md">Show All</button></li>
                        <% if @categories.any? then %>
                        <% @categories.each do |cat| %>
                        <li><button id="<%= cat.class %>" val="<%= cat.id %>" class="bg-dark-mode-lighter border border-gray-700 text-gray-100 hover:border-gray-700 hover:bg-gray-100 hover:text-gray-700 p-2 rounded-l-lg w-full text-sm sm:text-md"><%= cat.name %>/button></li>
                        <% end %>
                        <% end %>
                    </ul>
                    <%= inline_svg "add.svg", class: 'add-category icon mt-4 mx-auto w-6'%>
                </div>
                <div class="items bg-dark-mode-lighter border border-gray-700 ml-4 rounded shadow-md sm:w-5/6 text-gray-100 w-2/3">
                    <% if @items.any? then %>
                    <% @items.each do |item| %>
                    <div class="item pl-6 py-1">
                        <p class="item-content text-sm sm:text-md tracking-normal leading-normal text-grey-darkest"><%= item.content %></p>
                        <p class="item-notes gothic-neo text-gray-100"><%= item.notes %></p>
                    </div>
                    <% end %>
                    <% end %>
                </div>
            </div>
            <div class="absolute bottom-0 mb-12 container">
                <form accept-charset="UTF-8" id="item-form" data-remote="true" method="get"><input name="utf8" type="hidden" value="✓">
                    <div class="flex">
                        <input type="text" placeholder="New Item" name="item_content" id="item_content" class="bg-dark-mode-lighter border border-gray-700 gothic-neo p-2 pl-8 rounded text-gray-100 <% if @categories.any? %> w-10/12 <% else %> w-full <% end %>">
                        <% if @categories.any? then %>
                        <select name="category" id="category" class="w-2/12 border border-gray-700">
                            <% @categories.each do |cat| %>
                            <option value="<%= cat.id %>"><%= cat.name %></option>
                            <% end %>
                        </select>
                        <% end %>
                    </div>
                    <div class="flex">
                        <textarea id="item_notes" placeholder="Item Notes" class="block bg-dark-mode-lighter border border-gray-700 gothic-neo h-12 p-2 pl-8 rounded text-gray-100 w-11/12"></textarea>
                        <input type="submit" value="Add" class="w-1/12 bg-dark-mode-lighter border border-gray-700 text-gray-100 text-left p-1 flex rounded justify-around hover:bg-gray-800" />
                    </div>
                </form>
            </div>
        </div>
    </section>
    <div id="category-modal" class="absolute bg-gray-100 flex hidden mx-auto relative rounded w-1/3 z-50">
        <form action="/category/create" class="container px-6 py-2 z-20" accept-charset="UTF-8" id="category-form" data-remote="true" method="get"><input name="utf8" type="hidden" value="✓">
            <h2 class="text-lg py-3 text-center">Create a Category</h2>
            <input type="text" placeholder="Name" name="category_name" id="category_name" class="border border-gray-700 gothic-neo p-2 pl-8 my-2 rounded text-gray-700 w-full">
            <input type="text" placeholder="Color" name="category_color" id="category_color" class="border border-gray-700 gothic-neo p-2 pl-8 my-2 rounded text-gray-700 w-full">
            <input type="submit" value="Create" class="w-1/2 mx-auto border border-gray-700 text-gray-700 text-left my-2 p-1 flex rounded justify-around hover:bg-green-600" />
        </form>
    </div>
</body>

<% content_for :javascripts do %>
<script>
    //Sorting function for items
    $(function () {
        $('.category-list button').click(function () {
            window.category_id = this.val;
            window.category_name = this.id;
            var get_current = $('.items .' + window.category_name);

            $('.item').not(window.category_name).hide(500);
            window.category_name.show(500);
            console.log(window.category_name);
        });
        $('#showall').click(function () {
            $('.item').show(500);
        });
    });

    //get category selection from item form
    $("select.category").change(function () {
        window.selectedCategory = $(this).children("option:selected").val();
    });

    function save_item() {
        $('#item-form').submit(function (event) {
            event.preventDefault();
            console.log("Saving item");

            category_id = window.selectedCategory;
            item_content = $("#item_content").val();
            item_notes = $("#item_content").val();
            saveToDB();
        });
    }

    //adding categories function
    $('.add-category').on('click', function () {
        $('#category-modal').removeClass('hidden');
    })

    function save_category() {
        $('#item-form').submit(function (event) {
            event.preventDefault();
            console.log("Saving category");

            category_name = $("#category_name").val();
            category_color = $("#category_color").val();
            category_class = category_name.value.toLowerCase().replace(/\s/g, '');
            $('#category-modal').addClass('hidden');

            saveToDB();
        });
    }

    function saveToDB() {
        console.log("Saving to the db");
        $.ajax({
            async: false,
            type: "GET",
            data: {
                item_category: category_id,
                item_content: item_content,
                item_notes: item_notes,
                category_name: category_name,
                category_class: category_class
            },
            url: "/library/create",
            beforeSend: function (xhr) {
                // Let them know we are saving
                $(".form-status").html("Creating and Saving...");
            },
            fail: function () {
                $(".form-status").html("");
                $(".form-status").html("There was a problem saving...");
            },
            success: function () {
                $(".form-status").html("");
                $(".form-status").html("Saved! Last: " + d.toLocaleTimeString());
            }
        });
    }
</script>
<% end %>